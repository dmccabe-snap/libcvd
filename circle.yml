dependencies:
  pre:
    - sudo add-apt-repository ppa:ubuntu-toolchain-r/test -y
    - sudo apt-get update 
    - sudo apt-get install g++-7
    - curl -LO https://cmake.org/files/v3.11/cmake-3.11.4-Linux-x86_64.sh
    - bash ./cmake-3.11.4-Linux-x86_64.sh --prefix=cmake
  override:
    - mkdir cmake_build
    - ../cmake/cmake -DCMAKE_BUILD_TYPE=Release ..:
        pwd: cmake_build
        environment:
        - CXX: g++-7
    - make:
        pwd: cmake_build
    - make test:
        pwd: cmake_build
    - ./configure CXX="g++-7 -fuse-ld=gold"
    - make -j 4
    - sudo make install
    - sudo /sbin/ldconfig
test:
    override:
        - LD_LIBRARY_PATH=$PWD make test
